# Weather App (`weather_app.py`)
Приложение использует OpenWeatherMap для получения актуальной погоды через терминал после запуска weather_app.py
## Требования

- Python 3.x
- Зависимости из `requirements.txt`

## Установка

Рекомендуется использовать виртуальное окружение:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Настройка API ключа

Приложение ожидает ключ в переменной окружения `API_KEY` который вы получаете после регистрации на OpenWeatherMap https://openweathermap.org/.

Создайте файл `.env` в корне проекта:

```bash
API_KEY=ваш_ключ_openweathermap
```

### Запуск

```bash
python3 weather_app.py
```

После запуска откроется меню:

- `1` — получить погоду **по городу**
- `2` — получить погоду **по координатам** (`lat`, `lon`)
- `3` — **показать кэш** (последний успешный ответ)
- `0` — выход

### Как работает приложение

#### Получение по городу

1) Сначала выполняется запрос к геокодеру OpenWeatherMap, чтобы получить координаты города (`lat`, `lon`).
2) Затем выполняется запрос текущей погоды по координатам.

#### Получение по координатам

Сразу выполняется запрос текущей погоды по введённым `lat` и `lon`.

### Кэширование (`weather_cache.json`)

После **каждого успешного** получения погоды сохраняется файл `weather_cache.json` в корне проекта.
Это **последний успешный ответ**, кэш перезаписывается.

Структура файла:

- `city` — город (если запрос был по городу), иначе `null`
- `lat`, `lon` — координаты запроса
- `fetched_at` — время получения (UTC, ISO-8601)
- `data` — полный JSON-ответ OpenWeatherMap

Если при запросе возникает **временная сетевая ошибка**, приложение предложит вывести данные из кэша, если кэш **свежее 3 часов** и соответствует текущему запросу (по `city` или по `lat/lon`).

### Троттлинг / ретраи

При следующих ситуациях выполняются повторы запроса:

- HTTP `429` (throttling)
- HTTP `5xx` (временные ошибки сервера)
- временные сетевые ошибки (исключения `requests`)

Схема: до **3 повторов** с экспоненциальной паузой **1s, 2s, 4s**.

