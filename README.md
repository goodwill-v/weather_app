# Weather App + Telegram Bot
Добро пожаловать! Это дружелюбный погодный проект, который умеет получать данные от OpenWeather и красиво показывать их в терминале и в Telegram. Бот получился умным, отзывчивым и очень удобным: быстрый отклик, наглядные прогнозы, геолокация, сравнение городов и полезные уведомления — всё в одном месте.

Ссылка на действующий бот @weather_vz_bot

## Что умеет бот

Шесть основных функций, которые делают его действительно полезным:

- **Погода сейчас по городу** — температура, влажность, ветер, давление и описание погоды.
- **Прогноз на 5 дней с inline‑клавиатурой** — одно сообщение, листание по дням, кнопка «Назад».
- **Поиск по геолокации** — отправьте местоположение и получите погоду в точке.
- **Погодные уведомления** — каждые 2 часа бот проверяет изменение погоды и предупреждает о дожде завтра.
- **Сравнение городов** — наглядная таблица с температурой, влажностью и ощущением.
- **Расширенные данные** — всё, что возможно: облачность, видимость, восход/закат, индекс качества воздуха и др.

## Почему это удобно

- **Быстро** — минимальное число кликов и запросов.
- **Наглядно** — аккуратные inline‑сообщения и таблицы.
- **Практично** — уведомления о резких изменениях и дожде.
- **Умно** — бот запоминает геопозицию и последние города.

## Требования

- Python 3.x
- Зависимости из `requirements.txt`

## Установка

Рекомендуется использовать виртуальное окружение:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Настройка ключей

Проект использует две переменные окружения:

- `API_KEY` — ключ OpenWeatherMap (https://openweathermap.org/)
- `BOT_TOKEN` — токен вашего Telegram‑бота от @BotFather

Создайте файл `.env` в корне проекта:

```bash
API_KEY=ваш_ключ_openweathermap
BOT_TOKEN=ваш_токен_бота
```

## Запуск

### CLI‑версия (терминал)

```bash
python3 weather_app.py
```

После запуска откроется меню:

- `1` — текущая погода по городу
- `2` — текущая погода по координатам
- `3` — прогноз на 5 дней по городу
- `4` — прогноз на 5 дней по координатам
- `5` — данные о загрязнении воздуха
- `6` — показать кэш
- `0` — выход

### Telegram‑бот

```bash
python3 bot.py
```

В чате Telegram используйте меню — оно подскажет все действия.

## Как работает интеграция с API

Проект использует OpenWeatherMap:

- Геокодер — для определения координат города
- Current Weather — текущая погода
- Forecast 5d/3h — прогноз на 5 дней
- Air Pollution — качество воздуха

### Кэширование (`weather_cache.json`)

После каждого успешного запроса сохраняется файл `weather_cache.json`:

- `city` — город (если запрос был по городу), иначе `null`
- `lat`, `lon` — координаты запроса
- `fetched_at` — время получения (UTC, ISO‑8601)
- `data` — полный ответ OpenWeatherMap

Если сеть временно недоступна, приложение может показать свежие данные из кэша (до 3 часов).

### Ретраи и надежность

При временных ошибках запрос повторяется до 3 раз с паузой 1s, 2s, 4s:

- HTTP `429` (лимиты)
- HTTP `5xx` (ошибка сервера)
- сетевые сбои

## Файлы данных

- `User_Data.json` — сохраненные настройки пользователя, геолокация и подписки
- `weather_cache.json` — последний успешный ответ API

## Идеи для развития

Проект легко расширяется: можно добавить персональные пороги температуры, дополнительные уведомления или локальные часовые пояса.
